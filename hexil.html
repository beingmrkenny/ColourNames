<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Hexil</title>
        <style media="screen">
            body {
            	display: flex;
            	flex-direction: column;
            	align-items: center;
            	justify-content: space-around;


            	min-height: 100vh;
            	margin: 0;
            	padding: 0;

            	color: #fff;
            	background: #333;

            	font-family: sans-serif;
            }

            body.mod-light-background {
                color: black;
            }

            #Hue {
                background: linear-gradient(to right, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%);
            }

            input {
                padding: 5px;
                font-size: 20px;
                border-radius: 3px;
                border: 1px solid gray;
            }

            input[type="range"] {
                min-width: 500px;
                width: 90vw;
            }

            div {
            	display: flex;
            	align-items: center;
            	justify-content: center;
            }

            main {
                position: relative;
            }

            main > div {
                transform: rotateZ(-90deg) translate(40px,-56px);
                font-weight: bold;
                min-width: 410px;
                height: 10px;
                margin: 0 auto;
                white-space: nowrap;
                justify-content: space-between;
                top: 50%;
                left: -50%;
                position: absolute;
            }

            table {
            	border-collapse: collapse;
            }

            table div {
                margin: 0;
                white-space: nowrap;
                justify-content: space-between;
            }

            #LastChild th {
                padding-top: 40px;
                border-top: 2px solid white;
            }

            td {
            	width: 0;
            	height: 0;
            	padding: 2px;
                cursor: crosshair;
            }

            td.selected {
                filter: invert(100%);
            }

            tr:first-child td {
                border-top: 2px solid green;
            }

            td:first-child {
                border-left: 2px solid green;
            }

            td:last-child {
                border-right: 2px solid white;
            }

        </style>
    </head>
    <body>

        <!-- <p>Hue: <input type="number" name="hue" value="0" min="0" max="360" size="3">ยบ</p> -->
        <p id="Hue"><input type="range" name="hue" value="0" min="0" max="360"></p>

        <output name="hue-name">red</output>
        <output name="angle">0ยบ</output>
        <output name="hsv">hsv(0, 0%, 27%)</output>
        <output name="hex">#444444</output>

        <main>
            <div id="Left">
                <span>Low Brightness</span>
                <span>High Brightness</span>
            </div>
            <table>
                <tbody>
                    <tr id="LastChild">
                        <th colspan="101">
                            <div>
                                <span>Low Saturation</span>
                                <span>High Saturation</span>
                            </div>
                        </th>
                    </tr>
                </tbody>
            </table>
        </main>

        <script type="text/javascript" src="func.js"></script>
        <script type="text/javascript" src="Color.js"></script>
        <script type="text/javascript" src="ColorNames.js"></script>

        <script type="text/javascript">

            var h = 0;

            // var input = q('[name="hue"]');
            // input.addEventListener('change', function (event) {
            //     h = this.value;
            //     recolorAllTheCells();
            // });

            window.addEventListener("input", debounceListener ( function (event) {
                recolorAllTheCells();
                for (let selected of qq('.selected')) {
                    selected.classList.remove('selected');
                }
                q('[data-brightness="100"] [data-saturation="100"]').classList.add('selected');
                updateColorOutputs();
            }, 50), false);

            // left to right, increasing saturation
            // top to bottom, increasing brightness

            var tbody = q('tbody'),
                lastChild = qid('LastChild');

            for (let b = 100; b>=0; b--) {

                let row = document.createElement('tr');
                row.dataset.brightness = b;

                for (let s = 0; s<=100; s++) {
                    let cell = document.createElement('td');
                    cell.dataset.saturation = s;
                    cell.addEventListener('click', function (event) {
                        for (let selected of qq('.selected')) {
                            selected.classList.remove('selected');
                        }
                        this.classList.add('selected');
                        updateColorOutputs();
                    });
                    row.appendChild(cell);
                }

                tbody.insertBefore(row, lastChild);
            }

            function recolorAllTheCells() {
                for (let cell of qq('td')) {
                    let h = q('[name="hue"]').value;
                    let s = cell.dataset.saturation;
                    let b = cell.parentNode.dataset.brightness;
                    let hsv = `hsv(${h}, ${s}%, ${b}%)`;
                    let color = new ColorNames(hsv);
                    cell.dataset.hsv = hsv;
                    cell.style.backgroundColor = color.toHex();
                }
            }

            function updateColorOutputs () {
                var selected = q('.selected'),
                    backgroundColor = selected.style.backgroundColor,
                    color = new ColorNames(backgroundColor),
                    hsv = selected.dataset.hsv;

                document.body.style.backgroundColor = backgroundColor;
                document.body.classList.toggle('mod-light-background', color.isLight());

                q('[name="angle"]').value = q('[name="hue"]').value + 'ยบ';
                q('[name="hsv"]').value = hsv;
                q('[name="hex"]').value = color.toHex();
                q('[name="hue-name"]').value = color.getHueName();

            }

            recolorAllTheCells();

        </script>

    </body>
</html>
